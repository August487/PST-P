<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor de Agua - Realtime</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .main-layout { display: grid; grid-template-columns: 180px 1fr 280px; gap: 20px; max-width: 1100px; width: 100%; }
        .section { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
        
        .tank-border { width: 80px; height: 200px; border: 4px solid #37474f; border-radius: 5px 5px 15px 15px; position: relative; margin: 20px auto; background: #eee; overflow: hidden; }
        .water { position: absolute; bottom: 0; width: 100%; transition: height 1s ease; }

        .verde { background-color: #2e7d32 !important; }
        .rojo { background-color: #c62828 !important; }
        .status-header { color: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; }

        .luz { display: flex; align-items: center; gap: 10px; padding: 15px; border-radius: 10px; border: 2px solid #eee; font-weight: bold; margin-top: 10px; text-align: left; opacity: 0.2; }
        .activa-v { border-color: #2e7d32; background: #e8f5e9; color: #2e7d32; opacity: 1; }
        .activa-r { border-color: #c62828; background: #ffebee; color: #c62828; opacity: 1; }
        .circulo { width: 22px; height: 22px; border-radius: 50%; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; padding: 10px; border-bottom: 2px solid #ddd; font-size: 0.8rem; color: #666; text-transform: uppercase; }
        td { padding: 12px 10px; border-bottom: 1px solid #eee; text-align: left; font-size: 0.85rem; }
    </style>
    <meta http-equiv="refresh" content="5">
</head>
<body>

    <div class="main-layout">
        <div class="section">
            <h4>NIVEL</h4>
            <div class="tank-border">
                <div class="water <%= ok ? 'verde' : 'rojo' %>" style="height: <%= porcentaje %>%;"></div>
            </div>
            <strong><%= Math.round(porcentaje) %>%</strong>
        </div>

        <div class="section">
            <div class="status-header <%= ok ? 'verde' : 'rojo' %>">
                <span style="font-size: 4rem; font-weight: bold; display: block;"><%= datos.litros %> ml</span>
                <h2><%= ok ? 'SUFICIENTE' : 'INSUFICIENTE' %></h2>
                <small>Última actualización: <%= datos.actualizacion %></small>
            </div>
            
            <h3>Historial de Lecturas</h3>
            <table>
                <thead>
                    <tr>
                        <th>Fecha y Hora</th>
                        <th style="text-align: right;">Cantidad</th>
                    </tr>
                </thead>
                <tbody>
                    <% historial.forEach(function(item) { %>
                        <tr>
                            <td><%= item.fecha %></td>
                            <td style="text-align: right;"><strong><%= item.valor %> ml</strong></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h4>REFERENCIA (722.5 ml)</h4>
            <div class="luz <%= ok ? 'activa-v' : '' %>">
                <div class="circulo" style="background: #2e7d32;"></div>
                <span>SUFICIENTE</span>
            </div>
            <div class="luz <%= !ok ? 'activa-r' : '' %>">
                <div class="circulo" style="background: #c62828;"></div>
                <span>INSUFICIENTE</span>
            </div>
        </div>
    </div>

</body>
</html>
